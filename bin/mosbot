#!/usr/bin/env ruby

require 'mosbot'
# require_relative '../lib/mosbot'

#options
type  = ARGV.shift || "help"
id    = ARGV.shift

# setup environment
MOS_BOT_CONF = ENV['MOS_BOT_CONF'] || "#{ENV['HOME']}/.mosbot.conf"
if File.exists?(MOS_BOT_CONF) then
    File.readlines(MOS_BOT_CONF).each do |line|
        if line.start_with? "#" then
            next 
        else
            key, value = line.split "="
            ENV[key] = value.strip
        end
    end
end

# grab command line options
ARGV.each do |arg|
  case arg
  when "-o"
    ENV['MOS_OPEN_URL']="true"
  when "-c"
    ENV['MOS_COPY_URL']="true"
  end
end

# constants
OS_CONST            = os
MOS_COPY_URL        = ENV['MOS_COPY_URL'] || "false"
MOS_OPEN_URL        = ENV['MOS_OPEN_URL'] || "false"

case type
when "help"
  print_help()
when "doc"
  mosurl = "https://support.oracle.com/epmos/faces/DocumentDisplay?id=" + id
when "bug"
  mosurl = "https://support.oracle.com/epmos/faces/BugMatrix?id=" + id
when "patch"
  mosurl = "https://support.oracle.com/epmos/faces/PatchResultsNDetails?patchId=" + id
when "idea"
  mosurl = "https://community.oracle.com/ideas/" + id
else
  mosurl = "https://support.oracle.com/epmos/faces/DocumentDisplay?id=" + type
end

if type != "help"
  handle_output(mosurl)
end